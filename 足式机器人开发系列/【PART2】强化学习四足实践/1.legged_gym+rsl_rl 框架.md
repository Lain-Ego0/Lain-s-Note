# 强化学习+机器人运动控制：legged_gym + rsl_rl 框架环境配置技术文档
## 1. 文档概述
### 1.1 系列目标
本文档是「强化学习与机器人运动控制入门系列」的第一部分，核心目标是帮助开发者完成 legged_gym（环境）、rsl_rl（算法）、IsaacGym（仿真器）三大核心组件的环境搭建，为后续框架原理学习、代码解析及实战开发奠定基础。该系列将覆盖仿真器介绍、环境代码解析、算法实现等内容，助力快速入门强化学习在机器人运动控制领域的应用。

### 1.2 核心组件对应关系
强化学习的核心逻辑依赖 **agent（智能体）、environment（环境）、simulator（仿真器）** 三大组件的交互，本框架中三者的对应关系如下：
| 强化学习核心组件 | 对应框架模块       | 功能说明                                                                 |
|------------------|--------------------|--------------------------------------------------------------------------|
| Agent            | rsl_rl             | 实现强化学习算法逻辑，通过优化策略网络输出决策（action）                  |
| Environment      | legged_gym         | 作为 agent 与 simulator 的交互桥梁，提供状态反馈、奖励计算等核心功能     |
| Simulator        | IsaacGym Preview 4 | 提供高保真机器人仿真环境，支持实时物理引擎计算，为算法训练提供虚拟场景   |

### 1.3 内容定位
本文档聚焦 **环境配置环节**，后续系列文档将依次介绍：IsaacGym 仿真器核心功能、legged_gym 环境代码解析、rsl_rl 算法实现细节。

## 2. 环境配置前提
### 2.1 系统配置参考
以下为实测可用的基础配置（无需完全一致，仅作参考）：
- 操作系统：Ubuntu 22.04（兼容 wubuntu 22.04）
- 显卡：NVIDIA 4090D（需支持 CUDA 加速，显存建议 ≥12GB）
- 依赖管理工具：Anaconda（推荐，用于创建独立 Python 环境）

### 2.2 关键版本兼容说明
框架依赖的核心软件版本需严格匹配，避免兼容性问题：
| 软件/工具       | 推荐版本                  | 约束条件                                                                 |
|-----------------|---------------------------|--------------------------------------------------------------------------|
| Python          | 3.8                       | 框架代码较古早，高版本 Python（≥3.9）与部分依赖库冲突                     |
| CUDA            | ≥11.3（推荐 12.1+）       | 直接决定 PyTorch 版本选择，需提前通过 `nvcc -V` 命令确认本地 CUDA 版本    |
| PyTorch         | 2.4.1（对应 CUDA 12.1）   | CUDA 11.3~11.9 需选择 PyTorch 11.3 版本；CUDA ≥12.0 选择 12.1 版本        |
| IsaacGym        | Preview 4                 | Preview 4 为最终维护版本，功能稳定且兼容框架                             |
| rsl_rl          | v1.0.2                    | 框架指定版本，高版本可能存在接口不兼容                                   |
| TensorBoard     | 2.12.0                    | 高版本（2.13.0/2.14.0）存在运行报错，需指定版本安装                       |

## 3. 详细配置步骤
### 步骤 1：下载 legged_gym 核心代码
通过 Git 克隆官方代码仓库至本地（建议存放于文档目录下）：
```bash
git clone git@github.com:leggedrobotics/legged_gym.git
```
若未配置 SSH 密钥，可使用 HTTPS 链接：
```bash
git clone https://github.com:leggedrobotics/legged_gym.git
```

### 步骤 2：创建 Anaconda 独立环境
1. 打开终端，执行以下命令创建名为 `leggedGym`、Python 3.8 的环境：
```bash
conda create --name leggedGym python=3.8 -y
```
2. 激活环境（后续所有操作均需在该环境下执行）：
```bash
conda activate leggedGym
```

### 步骤 3：根据 CUDA 版本安装 PyTorch
1. 先通过以下命令确认本地 CUDA 版本：
```bash
nvcc -V
```
2. 按 CUDA 版本选择对应 PyTorch 安装命令：
   - 若 CUDA ≥12.1（推荐场景）：
```bash
conda install pytorch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1 pytorch-cuda=12.1 -c pytorch -c nvidia
```
   - 若 CUDA 11.3~11.9：
```bash
conda install pytorch==1.12.1 torchvision==0.13.1 torchaudio==0.12.1 cudatoolkit=11.3 -c pytorch -c conda-forge
```
> 注意：优先使用 Conda 安装，可自动解决依赖冲突；若使用 pip 可能出现包找不到或版本冲突问题。

### 步骤 4：下载并安装 IsaacGym Preview 4
1. 下载 IsaacGym Preview 4 安装包：  
   前往 B 站个人动态获取专属下载链接（确保下载 Preview 4 版本，后续版本不再维护）。
2. 解压安装包至本地，进入 Python 目录执行安装命令（使用清华源加速）：
```bash
cd isaacgym/python && pip install -e . -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 步骤 5：下载 rsl_rl v1.0.2 并整合至 legged_gym
1. 下载 rsl_rl v1.0.2 版本代码：  
   前往 GitHub 仓库 Releases 页面（https://github.com/leggedrobotics/rsl_rl/releases），下载 v1.0.2 版本的 ZIP 压缩包。
2. 解压压缩包，将文件夹重命名为 `rsl_rl`，并复制到 `legged_gym` 项目根目录下（便于后续代码阅读与跨模块调用）。

### 步骤 6：安装 rsl_rl 与 legged_gym 依赖库
1. 安装 rsl_rl 及其依赖：
```bash
cd legged_gym/rsl_rl && pip install -e . -i https://pypi.tuna.tsinghua.edu.cn/simple
```
2. 安装 legged_gym 及其依赖：
```bash
cd ../ && pip install -e . -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## 4. 常见报错及解决方案
### 报错 1：CUDA 与 PyTorch 版本不兼容
- 报错信息：`RuntimeError: nvrtc: error: invalid value for --gpu-architecture (-arch)`
- 原因：安装的 PyTorch 版本对应的 CUDA 架构与本地显卡不匹配（如 CUDA 12.4 安装了 PyTorch 11.3 版本）。
- 解决方案：卸载当前 PyTorch，按步骤 3 重新选择与本地 CUDA 匹配的版本安装。

### 报错 2：找不到 Python 链接库
- 报错信息：缺失 `libpython3.8.so` 等链接库相关错误。
- 原因：系统未识别 Anaconda 环境下的 Python 库路径。
- 解决方案：
  1. 临时解决（仅当前终端有效）：
```bash
export LD_LIBRARY_PATH=$CONDA_PREFIX/lib:$LD_LIBRARY_PATH
```
  2. 永久解决（激活环境自动生效）：
```bash
mkdir -p $CONDA_PREFIX/etc/conda/activate.d
echo 'export LD_LIBRARY_PATH=$CONDA_PREFIX/lib:$LD_LIBRARY_PATH' > $CONDA_PREFIX/etc/conda/activate.d/env_vars.sh
chmod +x $CONDA_PREFIX/etc/conda/activate.d/env_vars.sh
```

### 报错 3：找不到 TensorBoard 库
- 报错信息：`ModuleNotFoundError: No module named 'tensorboard'`
- 原因：框架依赖 TensorBoard 进行数据可视化，但默认安装步骤未包含该库。
- 解决方案：指定版本安装（必须为 2.12.0）：
```bash
pip install tensorboard==2.12.0 -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## 5. 验证与补充说明
### 5.1 环境验证
1. 执行 legged_gym 提供的示例脚本，若能正常启动仿真且无报错，则环境配置成功：
```bash
cd legged_gym/scripts
python train.py
```
2. 验证 TensorBoard 功能：  
   训练启动后，终端会输出 TensorBoard 访问地址（如 `http://localhost:6006/`），打开浏览器可查看训练数据可视化结果。

### 5.2 补充说明
- 临时环境变量与永久配置的区别：临时配置仅在当前终端生效，关闭终端后需重新执行命令；永久配置仅需设置一次，后续激活 `leggedGym` 环境时自动生效。
- 后续内容预告：下一篇文档将介绍 IsaacGym 仿真器的核心功能、场景配置及物理引擎参数调整，帮助理解仿真环境的工作机制。